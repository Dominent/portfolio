<ng-template let-node="node" #treeHeader>
    <header>
        <mat-icon mat-list-icon>folder</mat-icon>
        <div>
            <div>{{node.value.name}}</div>
            <div>{{node.value.updatedAt | date}}</div>
        </div>
    </header>
</ng-template>

<ng-container *ngIf="library$ | async as library">
    <mat-tree [dataSource]="libraries$" [treeControl]="libraryNodeTreeControl">
        <mat-tree-node *matTreeNodeDef="let node">
            <li (click)="nodeSelected(node)" [class.selected-node]="node.value.id === library.value.id">
                <ng-template [ngTemplateOutlet]="treeHeader" [ngTemplateOutletContext]="{node: node}">
                </ng-template>
            </li>
        </mat-tree-node>
        <mat-tree-node *matTreeNodeDef="let node; when: hasNoContent" matTreeNodePadding>
            <button mat-icon-button disabled></button>
            <mat-form-field>
              <input matInput placeholder="New item">
            </mat-form-field>
            <button mat-button (click)="addLibrary(node, 'placeholder')">Save</button>
          </mat-tree-node>
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
            <li (click)="nodeSelected(node)" [class.selected-node]="node.value.id === library.value.id">
                <ng-template [ngTemplateOutlet]="treeHeader" [ngTemplateOutletContext]="{node: node}">
                </ng-template>
                <button mat-icon-button (click)="addNewItem(node)"><mat-icon>add</mat-icon></button>
            </li>
            <ul>
                <ng-container matTreeNodeOutlet></ng-container>
            </ul>
        </mat-nested-tree-node>
    </mat-tree>
</ng-container>